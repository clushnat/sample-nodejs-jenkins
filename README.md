# Node.js Template Using Jenkins
이 프로젝트는 Node.js와 Express 프레임워크를 사용하여 RESTful API 서버 템플릿을 제공합니다. 각 기능은 다음과 같은 이점을 제공합니다:

* **Backstage 카탈로그 정의 포함**: CI/CD, 서비스 컴포넌트, API, 문서, 쿠버네티스 오브젝트 등과의 통합을 용이하게 하여 개발 프로세스를 간소화합니다.
* **Jenkins 스크립트 제공**: 빌드 및 배포 과정을 자동화하여 개발 효율성을 높입니다.
* **쿠버네티스 Helm 차트로 배포 형상 관리**: CPU 사용량에 따른 자동 스케일 아웃을 통해 리소스 사용 최적화 및 안정성을 보장합니다.
* **ArgoCD 를 통한 배포**: GitOps 방식으로 코드로 운영 환경을 관리할 수 있습니다.
* **OpenAPI 3.0 명세 사용**: 내부 및 외부에 API 명세를 명확하게 공유할 수 있어, API 통합 및 협업을 촉진합니다. ```User```에 대한 샘플 API 구현을 제공합니다.
* **Sequelize ORM 샘플 포함**: 데이터베이스 작업을 추상화하여 개발자가 보다 쉽게 데이터를 조작할 수 있게 합니다. SQLite 샘플 코드를 제공합니다.
* **Graceful Shutdown 구현**: 서비스 중단 시 데이터 손실을 방지하고 안정적인 서버 종료를 보장합니다.
* ~~**OAuth 2.0 표준 사용**: 보안 강화된 인증 방법을 제공하여 애플리케이션 보안을 강화합니다.~~
* ~~**RBAC 구현 일부 포함**: 인가 구현을 확장할 수 있어, 세분화된 접근 제어를 통해 보안을 더욱 강화할 수 있습니다.~~
* ~~**코드 작성 규칙**: 코드 작성 규칙을 제공합니다.~~

이러한 기능들은 개발자가 보다 빠르고 효율적으로 안정적인 API 서버를 구축할 수 있도록 돕습니다.

## 시작하기
이 프로젝트를 로컬에서 실행하기 위한 단계입니다.

### 초기화
```bash
npm install
```

## API 문서 생성
```generate-spec.js``` 스크립트를 실행하면, ```api/*-route.js``` 파일들에서 정의된 OpenAPI 명세를 수집하여 ```openapi.yaml``` 파일을 생성합니다.

이 생성된 파일은 서버가 제공하는 OpenAPI 명세를 문서화하기 위해 사용됩니다. 특히, Backstage는 API 자원을 별도로 관리하는 기능을 제공하며, 이 ```openapi.yaml``` 파일을 통해 Backstage 도구에서 자동으로 API 명세를 확인할 수 있습니다.
```bash
node scripts/generate-spec.js
```

## 로컬 환경 실행 방법
API 서버를 로컬 환경에서 기동하려면 다음 명령어를 실행합니다.
```bash
npm start
```

## API 단위 테스트
API 단위 테스트를 실행하려면 다음 명령어를 실행합니다.
```bash
npm test
```

## 샘플 API 호출 방법
사용자의 정보를 조회하기 위해, 다음 `curl` 명령을 사용할 수 있습니다. `{userId}`를 조회하고자 하는 사용자의 식별자로 교체하세요.
```bash
# 사용자 조회
curl -X GET http://localhost:8000/api/users/{userId}
```

## 템플릿을 통한 API 서버 개발
### 새로운 리소스에 대한 API 명세서 작성 방법
API 개발 시, 새로운 리소스에 대한 API 명세를 작성하는 것은 중요한 단계입니다. 본 프로젝트에서는 OpenAPI 3.0 문법을 따라 ```/src/api/``` 폴더 하위에 있는 ```*-router.js``` 파일 상단에 주석으로 API 명세를 정의하고 있습니다. 새로운 리소스의 API를 추가하기 전에, OpenAPI 3.0 문법에 대해 숙지하고 기존에 작성된 ```user-router.js``` 파일의 상단에 있는 주석으로 된 API 명세를 참고하는 것이 좋습니다. 이는 API 명세 작성의 기준을 제공하며, 새로운 리소스에 대한 명세 작성 시 유용한 참조 자료가 됩니다.

#### 새로운 리소스 API 명세 작성 단계
1. 리소스명-router.js 파일 생성: 새로운 리소스에 대한 API 명세를 작성하기 위해, ```/src/api/``` 폴더 내에 리소스명-router.js 파일을 생성합니다.
2. API 명세서 작성: 리소스명-router.js 파일 상단에 주석으로 새로운 API 명세를 YAML 형식으로 작성합니다.
3. 문서 검증: 작성된 API 명세가 OpenAPI 3.0 규격을 정확히 따르는지 검증합니다. 이를 위해 Swagger Editor와 같은 도구를 사용할 수 있습니다.

새로운 리소스에 대한 API 명세를 작성함으로써, API의 구조와 기능을 명확히 하고, 개발자 간의 의사소통을 원활하게 하며, API 통합을 용이하게 할 수 있습니다.

### 새로운 리소스에 대한 API 구현 방법

새로운 리소스에 대한 API를 구현하는 과정은 명세서 작성 후 실제 코드를 통해 해당 명세를 충족시키는 단계로 이루어집니다. 이 과정은 크게 두 부분으로 나뉩니다: HTTP 요청 처리 및 응답 구성(*-router.js 파일)과 비즈니스 로직 구현(*-service.js 파일).

#### 1. HTTP 요청 처리 및 응답 구성 (*-router.js)
```src/api/``` 디렉토리 하위의 ```*-router.js``` 파일은 HTTP(S) 요청을 파싱하고, RESTful API 명세에 맞춰 응답 데이터를 전송하는 로직을 담당합니다. 이 파일에서는 다음과 같은 작업을 수행합니다:

* 경로 정의: API 명세서에 정의된 경로(URL)와 HTTP 메소드(GET, POST, PUT, DELETE 등)를 설정합니다.
* 요청 데이터 파싱: 클라이언트로부터 받은 요청 데이터(예: 쿼리 파라미터, 바디 데이터)를 파싱합니다.
* 서비스 로직 호출: 파싱된 데이터를 바탕으로 해당 요청의 비즈니스 로직을 처리하는 서비스 함수를 호출합니다.
* 응답 데이터 전송: 서비스 로직의 처리 결과를 클라이언트에게 전송합니다. 이때, 상태 코드와 함께 결과 데이터를 RESTful API 명세에 맞게 구성하여 응답합니다.

#### 2. 비즈니스 로직 구현 (*-service.js)
```src/services/``` 디렉토리 하위의 ```*-service.js``` 파일은 요청의 비즈니스 로직을 구현하는 곳입니다. 이 파일에서는 다음과 같은 작업을 수행합니다:

* 비즈니스 로직 구현: 요청에 따른 실제 비즈니스 로직을 구현합니다. 이는 데이터 검증, 데이터 처리 로직 등을 포함할 수 있습니다.
* DB 엑세스: 데이터베이스에 접근하여 데이터를 조회, 생성, 수정, 삭제하는 로직을 구현합니다.
* 3rd party API 호출: 필요한 경우 외부 서비스의 API를 호출하여 데이터를 처리하거나, 추가 데이터를 획득합니다.
* 결과 반환: 처리된 결과를 *-router.js 파일로 반환하여, 최종적으로 클라이언트에게 전달될 수 있도록 합니다.

### 데이터 전송 로직 구현
이 섹션에서는 Sequelize ORM(Object-Relational Mapping)을 사용하여 데이터베이스와의 상호작용을 구현하는 방법에 대해 설명합니다. Sequelize는 Node.js 애플리케이션에서 데이터베이스 작업을 추상화하고, 쉽게 데이터를 조작할 수 있게 해주는 프로미스 기반의 ORM 라이브러리입니다.

#### Sequelize 소개
Sequelize는 다음과 같은 데이터베이스를 지원합니다:
* PostgreSQL
* MySQL
* MariaDB
* SQLite
* Microsoft SQL Server

이 ORM을 사용하면, SQL 쿼리를 직접 작성하지 않고도 데이터베이스 엔티티를 모델로 정의하고, 이를 통해 데이터를 조회, 생성, 수정, 삭제할 수 있습니다.

#### 모델 추가 방법
모델은 데이터베이스 테이블의 구조를 정의하는 클래스입니다. Sequelize를 사용하여 특정 모델을 추가하는 방법은 다음과 같습니다:

1. 모델 정의: define 메소드를 사용하여 모델을 정의합니다. 이 메소드는 모델 이름과 테이블의 스키마(열과 데이터 타입)를 매개변수로 받습니다.
    ```javascript
    const User = sequelize.define('User', {
    // 모델 필드 정의
    firstName: {
        type: Sequelize.STRING,
        allowNull: false
    },
    lastName: {
        type: Sequelize.STRING
        // allowNull 기본값은 true입니다.
    }
    }, {
    // 모델 옵션
    });
    ```
1. 모델 사용: 정의된 모델을 사용하여 데이터베이스 작업을 수행합니다. 예를 들어, 새로운 사용자를 생성하려면 다음과 같이 합니다.
    ```javascript
    User.create({
      firstName: 'Jane',
      lastName: 'Doe'
    }).then(user => {
      console.log(user.id);
    });
    ```

### 쿠버네티스 배포 형상 수정
쿠버네티스 배포를 위한 매니페스트 파일은 deployments 디렉토리 하위에 Helm 차트 형식으로 작성되어 있습니다. Helm은 쿠버네티스 애플리케이션의 패키징, 구성, 배포를 관리하는 도구입니다. Helm 차트는 애플리케이션의 리소스 정의를 포함하는 패키지로, 쿠버네티스 클러스터 내에서 애플리케이션, 서비스, 종속성 등을 쉽게 배포하고 관리할 수 있게 해줍니다.

### 빌드 스크립트 수정
TBD

### 컨테이너 이미지 스크립트 수정
TBD

### Backstage 카탈로그 수정
TBD

## 라이선스
이 프로젝트는 MIT 라이선스 하에 배포됩니다.